<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataMage</title>
    <link rel="stylesheet" href="/output.css">
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <!-- Alpine.js Component Example -->
            <div x-data="{ count: 0, message: 'Welcome to DataMage!' }" class="bg-white rounded-lg shadow-lg p-8">
                <h1 class="text-4xl font-bold text-center text-blue-600 mb-4" x-text="message"></h1>
                
                <div class="text-center mb-6">
                    <p class="text-gray-600 mb-2">Built with Tailwind CSS + Alpine.js</p>
                    <p class="text-sm text-gray-500">Click the button to increment the counter</p>
                </div>

                <div class="flex items-center justify-center gap-4 mb-6">
                    <button 
                        @click="count--" 
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition duration-200"
                    >
                        -
                    </button>
                    
                    <span class="text-3xl font-bold text-gray-800 min-w-[60px] text-center" x-text="count"></span>
                    
                    <button 
                        @click="count++" 
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-200"
                    >
                        +
                    </button>
                </div>

                <div class="text-center">
                    <button 
                        @click="count = 0" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded transition duration-200"
                    >
                        Reset
                    </button>
                </div>

                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-gray-700 text-center">
                        This is a demo app showcasing 
                        <span class="font-semibold text-blue-600">Tailwind CSS v4</span> 
                        styling with 
                        <span class="font-semibold text-blue-600">Alpine.js v3</span> 
                        reactivity
                    </p>
                </div>
            </div>

            <!-- Supabase Blog Demo -->
            <div x-data="blogList()" class="bg-white rounded-lg shadow-lg p-8 mt-8">
                <h2 class="text-3xl font-bold text-center text-purple-600 mb-6">Recent Blogs</h2>
                
                <div x-show="loading" class="text-center text-gray-500">
                    Loading blogs...
                </div>

                <div x-show="error" x-cloak class="text-center text-red-500" x-text="error"></div>

                <div x-show="!loading && !error && blogs.length === 0" x-cloak class="text-center text-gray-500">
                    No blogs yet. Add some in your Supabase dashboard!
                </div>

                <ul class="space-y-4">
                    <template x-for="blog in blogs" :key="blog.id">
                        <li class="border-l-4 border-purple-500 pl-4 py-2">
                            <h3 class="text-xl font-semibold text-gray-800" x-text="blog.title"></h3>
                            <p class="text-sm text-gray-600 mt-1" x-text="blog.excerpt"></p>
                            <p class="text-xs text-gray-400 mt-2" x-text="new Date(blog.created_at).toLocaleDateString()"></p>
                        </li>
                    </template>
                </ul>
            </div>
        </div>
    </div>

    <!-- Alpine.js bundled with the application -->
    <script>
        // Define blogList before loading Alpine
        window.blogList = function() {
            return {
                blogs: [],
                loading: true,
                error: null,
                async init() {
                    if (typeof window.supabase === 'undefined') {
                        this.error = 'Supabase client not initialized';
                        this.loading = false;
                        return;
                    }
                    
                    try {
                        const { data, error } = await window.supabase
                            .from('blog')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(5);
                        
                        if (error) throw error;
                        this.blogs = data || [];
                    } catch (err) {
                        this.error = err.message;
                        console.error('Error fetching blogs:', err);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
    <script src="/app.js"></script>
</body>
</html>
